<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>飞机大战 - 触屏酷炫版</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    background: black;
    overflow: hidden;
    height: 100%;
  }
  canvas {
    display: block;
    background: radial-gradient(ellipse at center, #001 0%, #000 100%);
  }
  .controls {
    position: fixed;
    bottom: 10px;
    left: 10px;
    z-index: 9999;
    display: flex;
    gap: 10px;
  }
  .btn {
    width: 60px;
    height: 60px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    border: 2px solid white;
    color: white;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
    touch-action: manipulation;
  }
  .fire-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: radial-gradient(circle, #ff0, #f00);
    border: 2px solid white;
    color: white;
    width: 70px;
    height: 70px;
    font-size: 24px;
  }
</style>
</head>
<body>
<canvas id="game"></canvas>
<div class="controls">
  <div class="btn" id="btn-up">↑</div>
</div>
<div class="controls" style="top: unset; bottom: 80px; flex-direction: column;">
  <div class="btn" id="btn-left">←</div>
  <div class="btn" id="btn-down">↓</div>
  <div class="btn" id="btn-right">→</div>
</div>
<div class="btn fire-btn" id="btn-fire">★</div>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let W = innerWidth, H = innerHeight;
canvas.width = W;
canvas.height = H;

let keys = {};
let player = {x: W/2, y: H-80, w: 40, h: 40, bullets: [], color: 'cyan'};
let enemies = [];
let particles = [];
let shakeTime = 0;
let hue = 0;

function spawnEnemy(){
  enemies.push({x: Math.random()*(W-40), y: -40, w: 40, h: 40, vy: 2});
}

function drawPlayer(){
  ctx.save();
  ctx.fillStyle = player.color;
  ctx.shadowColor = player.color;
  ctx.shadowBlur = 20;
  ctx.fillRect(player.x, player.y, player.w, player.h);
  ctx.restore();
}

function drawEnemies(){
  ctx.fillStyle = 'red';
  enemies.forEach(e => {
    ctx.save();
    ctx.shadowColor = 'red';
    ctx.shadowBlur = 15;
    ctx.fillRect(e.x, e.y, e.w, e.h);
    ctx.restore();
  });
}

function drawBullets(){
  ctx.fillStyle = 'yellow';
  player.bullets.forEach(b => {
    ctx.save();
    ctx.shadowColor = 'yellow';
    ctx.shadowBlur = 15;
    ctx.fillRect(b.x, b.y, b.w, b.h);
    ctx.restore();
  });
}

function drawParticles(){
  particles.forEach(p => {
    ctx.save();
    ctx.fillStyle = `hsla(${p.hue},100%,50%,${p.alpha})`;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
    ctx.fill();
    ctx.restore();
  });
}

function updateParticles(){
  particles.forEach((p,i)=>{
    p.x += p.vx;
    p.y += p.vy;
    p.alpha -= 0.02;
    if(p.alpha<=0) particles.splice(i,1);
  });
}

function createExplosion(x,y){
  for(let i=0;i<20;i++){
    particles.push({x,y,size:Math.random()*4+2,vx:(Math.random()-0.5)*4,vy:(Math.random()-0.5)*4,alpha:1,hue:Math.random()*360});
  }
}

function update(){
  if(keys['ArrowLeft']) player.x -= 5;
  if(keys['ArrowRight']) player.x += 5;
  if(keys['ArrowUp']) player.y -= 5;
  if(keys['ArrowDown']) player.y += 5;
  player.x = Math.max(0, Math.min(W-player.w, player.x));
  player.y = Math.max(0, Math.min(H-player.h, player.y));

  player.bullets.forEach((b, i) => {
    b.y -= 7;
    if(b.y<0) player.bullets.splice(i,1);
  });

  enemies.forEach((e, ei) => {
    e.y += e.vy;
    if(e.y>H) enemies.splice(ei,1);
    player.bullets.forEach((b, bi) => {
      if(b.x<e.x+e.w && b.x+b.w>e.x && b.y<e.y+e.h && b.y+b.h>e.y){
        createExplosion(e.x+e.w/2, e.y+e.h/2);
        enemies.splice(ei,1);
        player.bullets.splice(bi,1);
        shakeTime = 10;
      }
    });
    if(e.x<player.x+player.w && e.x+e.w>player.x && e.y<player.y+player.h && e.y+e.h>player.y){
      createExplosion(player.x+player.w/2, player.y+player.h/2);
      shakeTime = 20;
    }
  });
}

function draw(){
  ctx.clearRect(0,0,W,H);
  if(shakeTime>0){
    ctx.save();
    ctx.translate(Math.random()*10-5, Math.random()*10-5);
  }
  drawPlayer();
  drawEnemies();
  drawBullets();
  drawParticles();
  if(shakeTime>0){ctx.restore(); shakeTime--;}
}

setInterval(()=>spawnEnemy(),1000);
function loop(){
  update();
  draw();
  updateParticles();
  hue += 2;
  requestAnimationFrame(loop);
}
loop();

window.addEventListener('resize',()=>{
  W = innerWidth;
  H = innerHeight;
  canvas.width = W;
  canvas.height = H;
});

window.addEventListener('keydown',e=>keys[e.key]=true);
window.addEventListener('keyup',e=>keys[e.key]=false);

document.getElementById('btn-up').ontouchstart=()=>keys['ArrowUp']=true;
document.getElementById('btn-up').ontouchend=()=>keys['ArrowUp']=false;
document.getElementById('btn-down').ontouchstart=()=>keys['ArrowDown']=true;
document.getElementById('btn-down').ontouchend=()=>keys['ArrowDown']=false;
document.getElementById('btn-left').ontouchstart=()=>keys['ArrowLeft']=true;
document.getElementById('btn-left').ontouchend=()=>keys['ArrowLeft']=false;
document.getElementById('btn-right').ontouchstart=()=>keys['ArrowRight']=true;
document.getElementById('btn-right').ontouchend=()=>keys['ArrowRight']=false;
document.getElementById('btn-fire').ontouchstart=()=>{
  player.bullets.push({x: player.x+player.w/2-5, y: player.y, w: 10, h: 20});
};
</script>
</body>
</html>
